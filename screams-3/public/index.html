<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Ripple Demo</title>
    <style>
      body,
      html {
        height: 100%;
        width: 100%;
        margin: 0px;
      }

      body {
        overflow: hidden;
      }
    </style>
  </head>

  <body>
    <audio
      id="audioPlayer"
      src="./water effect echo.mp3"
      preload="auto"
      type="audio/mpeg"
    ></audio>


    <!-- female template -->
    <svg
      id="ripple-templateW"
      version="1.1"
      xmlns="http://www.w3.org/2000/svg"
      style="background: none; display: none; shape-rendering: auto"
      viewBox="-250 -250 500 500"
      preserveAspectRatio="xMidYMid"
    >

   <path fill="#ffc0cb" d="M38.82 215.13c-7.15.1-12.08-7.14-9.36-13.75.25-.61.5-1.22.75-1.84 3.16-7.75 6.54-15.44 9.13-23.39 2.36-7.24 4.7-14.37 8.94-20.78.93-1.41 1.18-3.39 1.38-5.14.44-4.02-1.98-16.9-4.5-20.78-.29-.44-.84-.62-1.32-.42-1.45.61-2.97 1.32-4.57 1.74-6.5 1.72-12.98 3.62-19.58 4.79-2.91.52-6.13-.34-7.89-3.71-.09-.16-.13-.35-.13-.53.03-2.42.45-5.08-.14-7.5-.52-2.12-1.92-4.02-3.09-6a1.09 1.09 0 0 1 .24-1.39c2.71-2.28 4.45-4.7 4.1-8.38-.37-3.8-3.12-5.75-5.63-7.92-.35-.3-.46-.8-.28-1.23.5-1.23.96-2.35 1.41-3.43a1.08 1.08 0 0 0-.51-1.37c-5.94-3.02-6.34-3.32-7.66-6.12-.16-.34-.14-.74.06-1.06 3.48-5.4 9.16-9.62 10.47-16.55.08-.43-.13-.87-.5-1.1-.95-.6-1.86-1.18-2.76-1.76-.03-.02.06-.21.1-.35.57-.11 1.14-.22 1.72-.33.59-.11.99-.69.86-1.28-1.4-6.18 1.18-12.24.62-18.54-.08-.86-1.11-1.26-1.77-.71-.78.65-1.51 1.25-2.19 1.81-.28.23-.42.6-.38.96.2 1.59.41 2.88.45 4.17v.04c.03 1.17-1.61 1.5-2.06.43-.38-.91-.72-1.83-1.06-2.74a6.57 6.57 0 0 1 3.01-8.04c1.07-.59 2.16-1.15 3.27-1.74.35-.19.58-.56.58-.96v-3.76c0-.3-.12-.58-.34-.79-1.61-1.51-3.39-3.04-4.95-4.75-3.45-3.79-2.3-8.47 2.54-10.02 2.25-.72 4.64-.99 7.01-1.41.4-.07.72-.36.84-.74.46-1.52.85-3.07 1.5-4.51 1.79-3.9 4.61-6.41 9.21-6.31 3.16.06 6.33.14 9.48-.02 2.79-.14 5.57-.56 8.25-.86.26-.03.49-.15.67-.34 1.62-1.74 2.93-3.34 4.48-4.66C51 .54 53.02-.69 55.56.44c6.57 2.91 13.55 2.9 20.49 2.47 3.44-.21 6.82-1.23 11.49-2.14.18-.04.37-.03.55.03 1.8.6 4.67 1.56 7.37 2.47.29.1.53.32.65.6 1.06 2.42 1.96 4.49 2.85 6.53.17.39.56.65.99.65h7.77c.31 0 .61.14.82.38l1.78 2.07c.15.17.24.39.26.62.31 3.53-.62 7.04 2.6 9.63.19.15.44.24.69.23 1.17-.02 2.52-.1 3.85.03 3.07.3 4.72 2.05 4.89 5.18.06 1.14-.11 2.31-.33 3.43-.44 2.3-.96 4.59-1.49 7.02-.09.43.08.88.44 1.13 1.62 1.11 3.19 2.13 4.65 3.31 1.55 1.26 2.97 2.68 4.23 3.86.17.16.29.38.33.61.9 5.39-2.05 9.7-2.57 14.38-.02.18.01.37.07.54 1.26 3.24 3.62 5.22 6.86 6.39 3.1 1.12 5.95 2.63 6.73 6.21.03.14.03.29 0 .43-.46 3.05-2.19 5.26-4.29 7.4-1.22 1.25-2.27 2.73-3.15 4.28-2 3.54-.52 7.87 3.27 9.34 3.53 1.37 6.05 3.58 7.11 7.43.05.19.05.39 0 .57-.81 3.19-1.65 6.33-3.71 9.19-2.07 2.89-3.51 6.24-4.97 9.03-.14.26-.16.57-.06.85 1.45 4.28 1.54 4.36 4.05 6.9.82.83 1.74 1.58 2.45 2.49 4.27 5.44 5.39 10.15-1.86 14.9-1.8 1.18-3.45 2.58-5.32 3.64-3.28 1.87-5.53 4.41-6.14 7.83-.03.14-.02.29 0 .43.32 1.56.69 3.1 1.01 4.62 1.18 5.64-2.3 11.14-7.76 12.57l-.75 1.37c1.89 5.85 3.51 11.49 5.62 16.95.94 2.45 1.67 4.94 2.31 7.45 1.3 5.17-2.59 10.2-7.92 10.27l-82.62 1.12Z" style="stroke-width:0" transform="translate(0 -100) scale(-1 1)">
    <animate
    attributeName="opacity"
    dur="2s"
    values="1;0"
    keyTimes="0;1"
    keySplines="0.2 0 0.8 1"
    calcMode="spline"
    begin="0s"
    fill="freeze"
  ></animate>
   </path>

      <circle r="5" fill="none" stroke="#ffc0cb" stroke-width="5">
        <animate
          attributeName="r"
          dur="2s"
          values="0;250"
          keyTimes="0;1"
          keySplines="0 0.2 0.8 1"
          calcMode="spline"
          begin="0s"
        ></animate>
        <animate
          attributeName="opacity"
          dur="2s"
          values="1;0"
          keyTimes="0;1"
          keySplines="0.2 0 0.8 1"
          calcMode="spline"
          begin="0s"
          fill="freeze"
        ></animate>
      </circle>



      <circle r="5" fill="none" stroke="#ffc0cb" stroke-width="5">
        <animate
          attributeName="opacity"
          dur="0.6s"
          values="0;0"
          keyTimes="0;1"
          keySplines="0.2 0 0.8 1"
          calcMode="spline"
          begin="0s"
          fill="freeze"
        ></animate>
        <animate
          attributeName="r"
          dur="2s"
          values="0;250"
          keyTimes="0;1"
          keySplines="0 0.2 0.8 1"
          calcMode="spline"
          begin="0.6s"
        ></animate>
        <animate
          attributeName="opacity"
          dur="2s"
          values="1;0"
          keyTimes="0;1"
          keySplines="0.2 0 0.8 1"
          calcMode="spline"
          begin="0.6s"
          fill="freeze"
        ></animate>
      </circle>
      
      <circle r="5" fill="none" stroke="#ffc0cb" stroke-width="5">
        <animate
          attributeName="opacity"
          dur="1.2s"
          values="0;0"
          keyTimes="0;1"
          keySplines="0.2 0 0.8 1"
          calcMode="spline"
          begin="0s"
          fill="freeze"
        ></animate>
        <animate
          attributeName="r"
          dur="2s"
          values="0;250"
          keyTimes="0;1"
          keySplines="0 0.2 0.8 1"
          calcMode="spline"
          begin="1.2s"
        ></animate>
        <animate
          class="last"
          attributeName="opacity"
          dur="2s"
          values="1;0"
          keyTimes="0;1"
          keySplines="0.2 0 0.8 1"
          calcMode="spline"
          begin="1.2s"
          fill="freeze"
        ></animate>
      </circle>
    </svg>

    <!-- male template -->
    <svg
      id="ripple-templateM"
      version="1.1"
      xmlns="http://www.w3.org/2000/svg"
      style="background: none; display: none; shape-rendering: auto"
      viewBox="-250 -250 500 500"
      preserveAspectRatio="xMidYMid"
    >



<path id="dude" d="M117.05 150.57c-2.75 3.8-5.42 7.65-7.97 11.59-2.1 3.23-4.07 6.55-5.9 9.94-.86 1.59-1.54 3.4-1.77 5.18-.41 3.24-.68 6.54-.53 9.79.15 3.15.98 6.25 2.34 9.16.56 1.18 1.29 2.77 2.06 4.46 2.01 4.39-1.2 9.39-6.03 9.39H19.4c-8.99 0-14.88-9.42-10.95-17.51.9-1.85 1.73-3.56 2.41-4.94 4.47-9.15 8.9-18.32 13.45-27.44 2.06-4.13 4.54-8.01 7.39-11.67 2.46-3.17 4.56-6.61 6.95-9.84 1.52-2.06 1.37-3.92.1-6.01-2.75-4.51-5.42-9.07-8.07-13.64-2.23-3.85-4.41-7.73-6.58-11.61-2.58-4.62-5.27-9.18-7.65-13.9-1.92-3.8-3.74-7.7-4.7-11.88-.43-1.86-.49-3.8-.76-5.7-.53-3.76-.66-7.55-.47-11.33.28-5.4 1.3-10.55 4.49-15.18 1.85-2.68 3.24-5.72 4.5-8.74 1.74-4.18 3.87-8.11 6.52-11.77.42-.58.93-1.08 1.49-1.51 4.53-3.44 9.03-6.93 13.66-10.23 3.68-2.62 7.49-5.07 11.32-7.47 2.79-1.75 6.02-2.58 9.13-3.5 5.59-1.65 11.25-3.08 16.93-4.43 2.66-.63 5.42-.87 8.14-1.27.33-.05.7.03 1.01-.08 2.75-.97 5.24-.15 7.74.96 5.15 2.28 9.52 5.62 13.47 9.57.71.71 1.21 1.61 1.9 2.34 1.39 1.47 1.25 3.24 1.07 5.01-.14 1.4-.4 2.79-.61 4.17 3.12 3.11 6.06 6.13 9.1 9.02 1.32 1.26 2.76 2.42 4.37 3.29 3 1.63 4.83 4.22 6.35 7.08 1.3 2.44 2.46 4.91 2.78 7.76.13 1.14.96 2.37 1.8 3.23a40.92 40.92 0 0 0 5.13 4.45c2.98 2.17 5.92 4.37 8.69 6.83 1.43 1.27 2.84 2.51 3.99 4.05 1.12 1.5 1.3 3.49.45 5.15-.43.84-.85 1.7-1.3 2.53-.88 1.6-2.13 2.75-3.92 3.35-1.74.58-3.41 1.34-5.35 2.12.74 1.07 1.34 1.94 2.02 2.93.13 1.89-1.71 2.33-2.8 3.34 0 0-7.76 6.15-5.24 14.37 1.11 5.84 3.3 10.83 7.8 14.15.68 2.18.16 3.88-.85 5.4-.9 1.36-.97 3.1-.13 4.5.53.88 1.04 1.78 1.33 2.77 1.27 4.31.62 8.27-2.54 11.41-.86.85-2.07 1.5-3.23 1.85-2.31.7-4.74.99-7.04 1.7-3.91 1.21-7.75 2.64-11.63 3.91-1.65.56-3.03 1.55-4.01 2.9" style="stroke-width:0" transform="translate(150 -100) scale(-1 1)"> 
  <animate
  attributeName="opacity"
  dur="2s"
  values="1;0"
  keyTimes="0;1"
  keySplines="0.2 0 0.8 1"
  calcMode="spline"
  begin="0s"
  fill="freeze"
></animate>
</path>



<g transform="translate(80,-10)"> <!-- Zentriert das Element im SVG -->
  <g> <!-- Skalierung um den Mittelpunkt -->
    <animateTransform
      attributeName="transform"
      attributeType="XML"
      type="scale"
      from="1"
      to="2"  
      dur="2s"
      repeatCount="indefinite"/>
      <path d="m21.78 1.22 1.29 7.12c.14.76 1.12.99 1.58.36l4.25-5.86c.58-.79 1.82-.19 1.56.75l-1.93 6.98c-.21.75.58 1.38 1.27 1.01l6.37-3.43c.86-.47 1.73.62 1.08 1.36l-4.77 5.45c-.51.58-.07 1.5.7 1.46l7.23-.33c.98-.04 1.29 1.31.39 1.69l-6.66 2.84c-.71.3-.71 1.32 0 1.62l6.66 2.84c.9.39.59 1.73-.39 1.69l-7.23-.33c-.77-.04-1.21.88-.7 1.46l4.77 5.45c.65.74-.22 1.82-1.08 1.36l-6.37-3.43c-.68-.37-1.47.26-1.27 1.01l1.93 6.98c.26.95-.99 1.55-1.56.75l-4.25-5.86a.881.881 0 0 0-1.58.36l-1.29 7.12c-.17.97-1.56.97-1.73 0l-1.29-7.12a.881.881 0 0 0-1.58-.36l-4.25 5.86c-.58.79-1.82.19-1.56-.75l1.93-6.98c.21-.75-.58-1.38-1.27-1.01l-6.37 3.43c-.86.47-1.73-.62-1.08-1.36l4.77-5.45c.51-.58.07-1.5-.7-1.46l-7.23.33c-.98.04-1.29-1.31-.39-1.69l6.66-2.84c.71-.3.71-1.32 0-1.62l-6.66-2.84c-.9-.39-.59-1.73.39-1.69l7.23.33c.77.04 1.21-.88.7-1.46L4.57 9.51c-.64-.74.22-1.82 1.08-1.35l6.37 3.43c.68.37 1.47-.26 1.27-1.01L11.36 3.6c-.26-.95.99-1.55 1.56-.75l4.25 5.86c.46.63 1.44.4 1.58-.36l1.29-7.12c.18-.97 1.56-.97 1.74-.01Z" style="fill:none;stroke:#1092c9;stroke-miterlimit:10">

  
      </path>
  </g>
</g>

      <circle r="5" fill="none" stroke="#1092c9" stroke-width="5">
        <animate
          attributeName="r"
          dur="2s"
          values="0;250"
          keyTimes="0;1"
          keySplines="0 0.2 0.8 1"
          calcMode="spline"
          begin="0s"
        ></animate>
        <animate
          attributeName="opacity"
          dur="2s"
          values="1;0"
          keyTimes="0;1"
          keySplines="0.2 0 0.8 1"
          calcMode="spline"
          begin="0s"
          fill="freeze"
        ></animate>
      </circle>
      <circle r="5" fill="none" stroke="#1092c9" stroke-width="5">
        <animate
          attributeName="opacity"
          dur="0.6s"
          values="0;0"
          keyTimes="0;1"
          keySplines="0.2 0 0.8 1"
          calcMode="spline"
          begin="0s"
          fill="freeze"
        ></animate>
        <animate
          attributeName="r"
          dur="2s"
          values="0;250"
          keyTimes="0;1"
          keySplines="0 0.2 0.8 1"
          calcMode="spline"
          begin="0.6s"
        ></animate>
        <animate
          class="last"
          attributeName="opacity"
          dur="2s"
          values="1;0"
          keyTimes="0;1"
          keySplines="0.2 0 0.8 1"
          calcMode="spline"
          begin="0.6s"
          fill="freeze"
        ></animate>
      </circle>
    </svg>
  </body>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    let offset_x = 0;
    let myGender = "";

    // send dimensions of the window to the server
    send_dimensions();

    // received a ripple event from another client (with gender)
    socket.on("ripple", (msg) => {
      console.log("msg.gender: ", msg.gender);
      add_ripple(msg.x - offset_x, msg.y, msg.gender);
    });

    socket.on("offset_x", (offset) => {
      console.log(offset);
      offset_x = offset;
    });

    socket.on("genderAssignment", (o) => {
      myGender = o;
      console.log("myGender:", myGender);
    });

    // create a ripple on click and send it to the other clients
    document.addEventListener("click", (e) => {
      // add ripple according to gender
      add_ripple(e.pageX, e.pageY, myGender.gender);

      // emit ripple to other clients with gender
      socket.emit("ripple", {
        x: offset_x + e.pageX,
        y: e.pageY,
        gender: myGender.gender,
      });
      let audioPlayer = document.getElementById("audioPlayer");

      // play gender specific sound
      audioPlayer.src = myGender.sound;
      audioPlayer.currentTime = 0;
      audioPlayer.play();
    });

    function add_ripple(x, y, gender) {
      // use the gender assigned ripple template (if templates are different)
      // if it's just about changing colors, you can use the same template and just hardcode the change of circle's colors
      let ripple_template_id = "";

      if (gender === "female") {
        ripple_template_id = "ripple-templateW";
      } else if (gender === "male") {
        ripple_template_id = "ripple-templateM";
      }

      // make a copy of the ripple template
      let ripple_template = document.getElementById(ripple_template_id);
      let new_ripple = ripple_template.cloneNode(true);
      // avoid duplicate IDs
      new_ripple.id = "ripple" + Math.random() * 1000;

      let width = 500;
      let height = 500;

      new_ripple.setAttribute("height", height + "px");
      new_ripple.setAttribute("width", width + "px");
      new_ripple.setAttribute(
        "viewBox",
        `-${width / 2} -${height / 2}  ${width} ${height}`
      );

      // set center of the ripple at the mouse position
      new_ripple.style.top = y - height / 2 + "px";
      new_ripple.style.left = x - width / 2 + "px";
      new_ripple.style.display = "block";
      new_ripple.style.position = "absolute";
      let animate = new_ripple.querySelector(".last");
      // remove the ripple after the animation ends
      animate.addEventListener("endEvent", () => {
        new_ripple.remove();
      });
      document.body.appendChild(new_ripple);
    }

    window.addEventListener("resize", function (event) {
      // TODO let the server handle window resize
      //     socket.emit('dimensions', { width: document.documentElement.clientWidth, height: document.documentElement.clientHeight });
    });

    function send_dimensions() {
      socket.emit("dimensions", {
        width: document.documentElement.clientWidth,
        height: document.documentElement.clientHeight,
      });
    }
  </script>
</html>